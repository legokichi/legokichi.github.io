
<h1>
<span id="haskell-で-ライフゲーム" class="fragment"></span><a href="#haskell-%E3%81%A7-%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B2%E3%83%BC%E3%83%A0"><i class="fa fa-link"></i></a>Haskell で ライフゲーム</h1>

<p>GHC拡張なしには生きていけないと思いました（こなみ</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span class="cp">{-# LANGUAGE TypeSynonymInstances #-}</span>
<span class="cp">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>
<span class="cp">{-# LANGUAGE FlexibleInstances #-}</span>
<span class="cp">{-# LANGUAGE IncoherentInstances #-}</span>

<span class="kr">module</span> <span class="nn">LifeGame</span>
    <span class="p">(</span> <span class="kt">LifeGameIO</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
    <span class="p">,</span> <span class="nf">game</span>
    <span class="p">)</span> <span class="kr">where</span>


<span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">join</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Control.Monad.Trans</span> <span class="p">(</span><span class="kt">MonadIO</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">Data.Array.IO</span> <span class="p">(</span><span class="nf">newArray</span><span class="p">,</span> <span class="kt">IOUArray</span><span class="p">,</span> <span class="nf">writeArray</span><span class="p">,</span> <span class="nf">readArray</span><span class="p">,</span> <span class="nf">newListArray</span><span class="p">,</span> <span class="nf">getBounds</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Array.Unboxed</span> <span class="p">(</span><span class="kt">UArray</span><span class="p">,</span> <span class="nf">array</span><span class="p">,</span> <span class="nf">listArray</span><span class="p">,</span> <span class="nf">bounds</span><span class="p">,</span> <span class="p">(</span><span class="o">!</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">System.Random</span> <span class="p">(</span><span class="nf">getStdRandom</span><span class="p">,</span> <span class="nf">randomR</span><span class="p">)</span>


<span class="c1">--      + Type Constructor</span>
<span class="cd">--      |          + Type Parameter</span>
<span class="cd">--      |          |   + Data Constructor: LifeGameIO :: IO a -&gt; LifeGameIO a</span>
<span class="cd">--      |          |   |          + Data Parameter (Record Statement)</span>
<span class="cd">--      |          |   |          |</span>
<span class="kr">newtype</span> <span class="kt">LifeGameIO</span> <span class="n">a</span> <span class="o">=</span> <span class="kt">LifeGameIO</span> <span class="p">{</span>
<span class="c1">--    + Accessor</span>
<span class="cd">--    |                + Type</span>
<span class="cd">--    |                |</span>
      <span class="n">runLifeGameIO</span> <span class="o">::</span> <span class="kt">IO</span> <span class="n">a</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Functor</span><span class="p">,</span> <span class="kt">Applicative</span><span class="p">,</span> <span class="kt">Monad</span><span class="p">)</span>
<span class="cd">--    |        |</span>
<span class="cd">--    |        + Super Classes (or deriving (Applicative, Monad) )</span>
<span class="c1">--    + Type Class auto deriving to instance method</span>

<span class="c1">-- FlexibleInstances</span>
<span class="c1">-- + LifeGameIO is instance of MonadIO Type Class</span>
<span class="cd">-- |</span>
<span class="kr">instance</span> <span class="kt">MonadIO</span> <span class="kt">LifeGameIO</span> <span class="kr">where</span>
    <span class="n">liftIO</span> <span class="o">=</span> <span class="kt">LifeGameIO</span>
<span class="cd">--  |        |</span>
<span class="cd">--  |        + actual method: LifeGameIO :: IO a -&gt; LifeGameIO a</span>
<span class="c1">--  + ideal method: liftIO :: IO a -&gt; m a</span>



<span class="c1">--   + Type Constructor</span>
<span class="cd">--   |      </span>
<span class="cd">--   |       + Mutable, unboxed, strict arrays</span>
<span class="cd">--   |       |        + width and height Index Types</span>
<span class="cd">--   |       |        |          + element type</span>
<span class="cd">--   |       |        |          |</span>
<span class="kr">type</span> <span class="kt">Field</span> <span class="o">=</span> <span class="kt">IOUArray</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="kt">Bool</span>

<span class="n">newField</span> <span class="o">::</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="kt">Field</span>
<span class="n">newField</span> <span class="n">width</span> <span class="n">height</span> <span class="o">=</span> <span class="kt">LifeGameIO</span> <span class="o">$</span> <span class="n">newArray</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="kt">False</span>
<span class="cd">--                      |            |</span>
<span class="cd">--                      |            + newArray :: Ix i =&gt; (i, i) -&gt; e -&gt; m (a i e)</span>
<span class="c1">--                      + LifeGameIO :: IO Field -&gt; LifeGameIO Field</span>

<span class="n">readField</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="kt">Bool</span>
<span class="n">readField</span> <span class="n">fld</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">getBounds</span> <span class="n">fld</span>
    <span class="kr">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">startW</span><span class="p">)</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="p">(</span><span class="n">stopW</span> <span class="o">-</span> <span class="n">startW</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kr">let</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">startH</span><span class="p">)</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="p">(</span><span class="n">stopH</span> <span class="o">-</span> <span class="n">startH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">readArray</span> <span class="n">fld</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="n">writeField</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="nb">()</span>
<span class="n">writeField</span> <span class="n">fld</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">flag</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">getBounds</span> <span class="n">fld</span>
    <span class="kr">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">startW</span><span class="p">)</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="p">(</span><span class="n">stopW</span> <span class="o">-</span> <span class="n">startW</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kr">let</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">startH</span><span class="p">)</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="p">(</span><span class="n">stopH</span> <span class="o">-</span> <span class="n">startH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">writeArray</span> <span class="n">fld</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="n">flag</span>

<span class="n">getFieldNeighbourhoods</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="p">[</span><span class="kt">Bool</span><span class="p">]</span>
<span class="n">getFieldNeighbourhoods</span> <span class="n">fld</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">getBounds</span> <span class="n">fld</span>
    <span class="n">alive</span> <span class="o">&lt;-</span> <span class="n">readField</span> <span class="n">fld</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="kr">let</span> <span class="n">read</span> <span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">)</span> <span class="o">=</span> <span class="n">readField</span> <span class="n">fld</span> <span class="p">(</span><span class="n">ox</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">around</span> <span class="o">&lt;-</span> <span class="n">mapM</span> <span class="n">read</span> <span class="n">neighbourhoods</span>
    <span class="n">return</span> <span class="n">around</span>
    <span class="kr">where</span>
        <span class="n">neighbourhoods</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                         <span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                         <span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>


<span class="n">showField</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="kt">String</span>
<span class="n">showField</span> <span class="n">fld</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">getBounds</span> <span class="n">fld</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">mapM</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="kr">do</span>
        <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">mapM</span> <span class="p">(</span><span class="nf">\</span><span class="n">y</span> <span class="o">-&gt;</span> <span class="n">get</span> <span class="n">fld</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="p">[</span><span class="n">startH</span><span class="o">..</span><span class="n">stopH</span><span class="p">]</span>
        <span class="n">return</span> <span class="o">$</span> <span class="p">(</span><span class="n">join</span> <span class="n">a</span><span class="p">)</span> <span class="o">++</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
     <span class="p">)</span> <span class="p">[</span><span class="n">startW</span><span class="o">..</span><span class="n">stopW</span><span class="p">]</span>
    <span class="n">return</span> <span class="o">$</span> <span class="n">join</span> <span class="n">b</span>
    <span class="kr">where</span>
        <span class="n">get</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="kt">String</span>
        <span class="n">get</span> <span class="n">fld</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="kr">do</span>
            <span class="n">flag</span> <span class="o">&lt;-</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">readArray</span> <span class="n">fld</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="kt">LifeGameIO</span> <span class="o">$</span> <span class="n">return</span> <span class="o">$</span> <span class="kr">if</span> <span class="n">flag</span> <span class="kr">then</span> <span class="s">"#"</span> <span class="kr">else</span> <span class="s">"_"</span>

<span class="n">putField</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="nb">()</span>
<span class="n">putField</span> <span class="n">fld</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="n">showField</span> <span class="n">fld</span> <span class="o">&gt;&gt;=</span> <span class="nf">\</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">putStrLn</span> <span class="n">str</span>
<span class="cd">--  |             |           |        |</span>
<span class="cd">--  |             |           |        + putStrLn :: String -&gt; IO ()</span>
<span class="cd">--  |             |           + liftIO :: IO () -&gt; LifeGameIO ()</span>
<span class="cd">--  |             + (&gt;&gt;=) :: LifeGameIO String -&gt; (String -&gt; LifeGameIO ()) -&gt; LifeGameIO ()</span>
<span class="c1">--  + showField :: Field -&gt; LifeGameIO String</span>


<span class="n">updateField</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="nb">()</span>
<span class="n">updateField</span> <span class="n">curr</span> <span class="n">next</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">getBounds</span> <span class="n">curr</span> 
    <span class="n">mapM_</span> <span class="n">update</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="n">startW</span><span class="o">..</span><span class="n">stopW</span><span class="p">],</span> <span class="n">y</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="n">startH</span><span class="o">..</span><span class="n">stopH</span><span class="p">]]</span>
    <span class="kr">where</span>
        <span class="n">update</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="kr">do</span>
<span class="c1">--                   + getFieldNeighbourhoods :: Field -&gt; (Int, Int) -&gt; LifeGameIO [Bool]</span>
<span class="cd">--                   |</span>
            <span class="n">bools</span> <span class="o">&lt;-</span> <span class="n">getFieldNeighbourhoods</span> <span class="n">curr</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="kr">let</span> <span class="n">centor</span> <span class="o">=</span> <span class="n">bools</span><span class="o">!!</span><span class="mi">4</span>
            <span class="kr">let</span> <span class="n">others</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="n">bools</span><span class="p">)</span> <span class="o">-</span> <span class="kr">if</span> <span class="n">centor</span> <span class="kr">then</span> <span class="mi">1</span> <span class="kr">else</span> <span class="mi">0</span>
            <span class="kr">case</span> <span class="n">others</span> <span class="kr">of</span>
                <span class="mi">3</span> <span class="o">-&gt;</span> <span class="n">writeField</span> <span class="n">next</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="kt">True</span>
                <span class="mi">2</span> <span class="o">-&gt;</span> <span class="n">writeField</span> <span class="n">next</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">centor</span>
                <span class="kr">_</span> <span class="o">-&gt;</span> <span class="n">writeField</span> <span class="n">next</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="kt">False</span>
        <span class="n">count</span> <span class="kt">[]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="n">xs</span><span class="p">)</span> <span class="o">=</span> <span class="kr">if</span> <span class="n">x</span> <span class="kr">then</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">count</span> <span class="n">xs</span> <span class="kr">else</span> <span class="n">count</span> <span class="n">xs</span>



<span class="c1">--             + Arrays with unboxed elements. Instances of</span>
<span class="cd">--             |      + index type</span>
<span class="cd">--             |      |   + element type</span>
<span class="cd">--             |      |   |</span>
<span class="kr">type</span> <span class="kt">Pattern</span> <span class="o">=</span> <span class="kt">UArray</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="kt">Bool</span>

<span class="c1">-- TypeSynonymInstances</span>
<span class="c1">-- IncoherentInstances</span>
<span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">Pattern</span> <span class="kr">where</span>
    <span class="n">show</span> <span class="n">pat</span> <span class="o">=</span> <span class="kr">let</span>
        <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">=</span> <span class="n">bounds</span> <span class="n">pat</span>
        <span class="kr">in</span>
        <span class="p">(</span><span class="n">join</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="o">-&gt;</span>
            <span class="p">(</span><span class="n">join</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">y</span> <span class="o">-&gt;</span>
                <span class="kr">if</span> <span class="n">pat</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="kr">then</span> <span class="s">"#"</span> <span class="kr">else</span> <span class="s">"_"</span>
            <span class="p">)</span> <span class="p">[</span><span class="n">startH</span><span class="o">..</span><span class="n">stopH</span><span class="p">])</span> <span class="o">++</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
        <span class="p">)</span> <span class="p">[</span><span class="n">startW</span><span class="o">..</span><span class="n">stopW</span><span class="p">])</span>



<span class="c1">--        + UArray Int Bool</span>
<span class="cd">--        |</span>
<span class="n">glider</span> <span class="o">::</span> <span class="kt">Pattern</span>
<span class="c1">--       + listArray :: (Int, Int) -&gt; [Bool] -&gt; UArray Int Bool</span>
<span class="cd">--       |</span>
<span class="cd">--       |          + glider!(0, 0) == False</span>
<span class="cd">--       |          |       + glider!(2, 2) == True</span>
<span class="cd">--       |          |       |</span>
<span class="n">glider</span> <span class="o">=</span> <span class="n">listArray</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">[</span> <span class="kt">False</span><span class="p">,</span> <span class="kt">True</span><span class="p">,</span>  <span class="kt">False</span>
                                    <span class="p">,</span> <span class="kt">False</span><span class="p">,</span> <span class="kt">False</span><span class="p">,</span> <span class="kt">True</span> 
                                    <span class="p">,</span> <span class="kt">True</span><span class="p">,</span>  <span class="kt">True</span><span class="p">,</span>  <span class="kt">True</span> <span class="p">]</span>

<span class="c1">--            + IOUArray (Int, Int) Bool</span>
<span class="cd">--            |                      + UArray Int Bool</span>
<span class="cd">--            |                      |</span>
<span class="n">setPattern</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Pattern</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="nb">()</span>
<span class="n">setPattern</span> <span class="n">fld</span> <span class="n">offsetX</span> <span class="n">offsetY</span> <span class="n">pat</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="kr">let</span> <span class="p">((</span><span class="n">startW</span><span class="p">,</span> <span class="n">startH</span><span class="p">),</span> <span class="p">(</span><span class="n">stopW</span><span class="p">,</span> <span class="n">stopH</span><span class="p">))</span> <span class="o">=</span> <span class="n">bounds</span> <span class="n">pat</span>
    <span class="kr">let</span> <span class="n">offsets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="n">startW</span><span class="o">..</span><span class="n">stopW</span><span class="p">],</span> <span class="n">y</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="n">startH</span><span class="o">..</span><span class="n">stopH</span><span class="p">]]</span>
<span class="c1">--  mapM_ :: ((Int, Int) -&gt; IO ()) -&gt; [(Int, Int)] -&gt; IO ()</span>
<span class="cd">--  |</span>
    <span class="n">mapM_</span> <span class="n">put</span> <span class="n">offsets</span>
    <span class="kr">where</span>
        <span class="n">put</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">liftIO</span> <span class="o">$</span> <span class="n">writeArray</span> <span class="n">fld</span> <span class="p">(</span><span class="n">offsetX</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">offsetY</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">$</span> <span class="n">pat</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="cd">--                            |          |                                |</span>
<span class="cd">--                            |          |                                + UArray (Int, Int) Bool</span>
<span class="cd">--                            |          + IOUArray (Int, Int) Bool</span>
<span class="c1">--                            + writeArray :: IOUArray (Int, Int) Bool -&gt; (Int, Int) -&gt; Bool -&gt; IO ()</span>



<span class="n">game</span> <span class="o">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">game</span> <span class="o">=</span> <span class="n">runLifeGameIO</span> <span class="o">$</span> <span class="kr">do</span>
<span class="cd">--     |</span>
<span class="c1">--     + runLifeGameIO :: IO ()</span>
    <span class="n">test</span>
<span class="c1">--  + liftIO :: IO () -&gt; LifeGameIO ()</span>
<span class="cd">--  |        + putStrLn :: String -&gt; IO ()</span>
<span class="cd">--  |        |</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="n">show</span> <span class="n">glider</span>
<span class="c1">--            + newField :: Int -&gt; Int -&gt; LifeGameIO Field</span>
<span class="cd">--            |</span>
    <span class="n">field1</span> <span class="o">&lt;-</span> <span class="n">newField</span> <span class="mi">10</span> <span class="mi">10</span>
    <span class="n">field2</span> <span class="o">&lt;-</span> <span class="n">newField</span> <span class="mi">10</span> <span class="mi">10</span>
<span class="c1">--  + setPattern :: Field -&gt; Int -&gt; Int -&gt; Pattern -&gt; LifeGameIO ()</span>
<span class="cd">--  |</span>
    <span class="n">setPattern</span> <span class="n">field1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">glider</span>
    <span class="n">putField</span> <span class="n">field1</span>
    <span class="kr">let</span> <span class="n">step</span> <span class="kr">_</span> <span class="o">=</span> <span class="kr">do</span> <span class="p">{</span>
        <span class="n">updateField</span> <span class="n">field1</span> <span class="n">field2</span><span class="p">;</span>
        <span class="n">putField</span> <span class="n">field2</span><span class="p">;</span>
        <span class="n">updateField</span> <span class="n">field2</span> <span class="n">field1</span><span class="p">;</span>
        <span class="n">putField</span> <span class="n">field1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">mapM_</span> <span class="n">step</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">]</span>
    <span class="n">return</span> <span class="nb">()</span>





<span class="n">test</span> <span class="o">::</span> <span class="kt">LifeGameIO</span> <span class="nb">()</span>
<span class="n">test</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">print</span> <span class="s">"test start"</span>
    <span class="n">field1</span> <span class="o">&lt;-</span> <span class="n">newField</span> <span class="mi">10</span> <span class="mi">10</span>
    <span class="n">setPattern</span> <span class="n">field1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">glider</span>
    <span class="n">bools</span> <span class="o">&lt;-</span> <span class="n">getFieldNeighbourhoods</span> <span class="n">field1</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kr">let</span> <span class="n">d</span> <span class="o">=</span> <span class="p">[</span> <span class="kt">False</span><span class="p">,</span> <span class="kt">True</span><span class="p">,</span>  <span class="kt">False</span>
            <span class="p">,</span> <span class="kt">False</span><span class="p">,</span> <span class="kt">False</span><span class="p">,</span> <span class="kt">True</span>
            <span class="p">,</span> <span class="kt">True</span><span class="p">,</span>  <span class="kt">True</span><span class="p">,</span>  <span class="kt">True</span> <span class="p">]</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">print</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="o">$</span> <span class="n">zip</span> <span class="n">bools</span> <span class="n">d</span>
    <span class="kr">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">,</span>       <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>      <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>      <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">,</span>                   <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">,</span>                         <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="p">]</span>
    <span class="kr">let</span> <span class="n">b</span> <span class="o">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">10</span><span class="p">))</span> <span class="n">a</span>
    <span class="kr">let</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span> <span class="kt">False</span>
            <span class="p">,</span>       <span class="kt">False</span><span class="p">,</span>      <span class="kt">True</span>
            <span class="p">,</span> <span class="kt">True</span><span class="p">,</span>        <span class="kt">False</span>
            <span class="p">,</span>                    <span class="kt">True</span>
            <span class="p">,</span>                         <span class="kt">False</span> <span class="p">]</span>
<span class="c1">--                  + readField :: Field -&gt; (Int, Int) -&gt; LifeGameIO Bool</span>
<span class="cd">--                  |</span>
    <span class="n">boolsA</span> <span class="o">&lt;-</span> <span class="n">mapM</span> <span class="p">(</span><span class="n">readField</span> <span class="n">field1</span><span class="p">)</span> <span class="n">a</span>
    <span class="n">boolsB</span> <span class="o">&lt;-</span> <span class="n">mapM</span> <span class="p">(</span><span class="n">readField</span> <span class="n">field1</span><span class="p">)</span> <span class="n">b</span>
    <span class="c1">--liftIO $ print boolsA</span>
    <span class="c1">--liftIO $ print boolsB</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">print</span> <span class="o">$</span> <span class="n">all</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="kt">True</span><span class="p">)</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="o">$</span> <span class="n">zip</span> <span class="n">boolsA</span> <span class="n">c</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">print</span> <span class="o">$</span> <span class="n">all</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="kt">True</span><span class="p">)</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="o">$</span> <span class="n">zip</span> <span class="n">boolsB</span> <span class="n">c</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">print</span> <span class="s">"test end"</span>
    <span class="n">return</span> <span class="nb">()</span>

<span class="c1">--                  + IOUArray (Int, Int) Bool</span>
<span class="cd">--                  |</span>
<span class="n">randFieldOneCell</span> <span class="o">::</span> <span class="kt">Field</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="nb">()</span>
<span class="n">randFieldOneCell</span> <span class="n">field</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="o">=</span> <span class="kr">do</span>
<span class="c1">--       + randInt :: LifeGameIO Int</span>
<span class="cd">--       |</span>
    <span class="n">r</span> <span class="o">&lt;-</span> <span class="n">randRange</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kr">let</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1">-- 1/10 probabry</span>
    <span class="n">liftIO</span> <span class="o">$</span> <span class="n">writeArray</span> <span class="n">field</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">flag</span>
<span class="cd">--  |        |          |            |</span>
<span class="cd">--  |        |          |            + Bool</span>
<span class="cd">--  |        |          + IOUArray (Int, Int) Bool</span>
<span class="cd">--  |        + writeArray :: IOUArray (Int, Int) Bool -&gt; (Int, Int) -&gt; Bool -&gt; IO ()</span>
<span class="c1">--  + liftIO :: IO () -&gt; LifeGameIO ()</span>


<span class="n">randRange</span> <span class="o">::</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">LifeGameIO</span> <span class="kt">Int</span>
<span class="n">randRange</span> <span class="n">range</span> <span class="o">=</span> <span class="kt">LifeGameIO</span> <span class="o">$</span> <span class="n">getStdRandom</span> <span class="o">$</span> <span class="n">randomR</span> <span class="n">range</span>
<span class="cd">--                |            |              |</span>
<span class="cd">--                |            |              + randomR :: (Int, Int) -&gt; StdGen -&gt; (Int, StdGen)</span>
<span class="cd">--                |            + getStdRandom :: (StdGen -&gt; (Int, StdGen)) -&gt; IO Int</span>
<span class="c1">--                + LifeGameIO :: IO Int -&gt; LifeGameIO Int</span>
</pre></div></div>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li>オライリー Real World Haskell</li>
<li><a href="http://d.hatena.ne.jp/lamuu/20060825/1156520199" rel="nofollow noopener" target="_blank">Life Game完成 - lamuuの勿忘草日記</a></li>
<li><a href="https://www.stackage.org/" rel="nofollow noopener" target="_blank">Stackage Server</a></li>
<li><a href="https://www.haskell.org/hoogle/" rel="nofollow noopener" target="_blank">Hoogle</a></li>
<li><a href="https://wiki.mma.club.uec.ac.jp/kurubushi/haskell_pragmas" rel="nofollow noopener" target="_blank">kurubushi/haskell_pragmas - 電気通信大学MMA</a></li>
<li><a href="http://www.slideshare.net/xenophobia__/ss-14558187" rel="nofollow noopener" target="_blank">すごい配列楽しく学ぼう</a></li>
<li><a href="http://www.sampou.org/haskell/a-a-monads/html/index.html" rel="nofollow noopener" target="_blank">All About Monads</a></li>
</ul>
