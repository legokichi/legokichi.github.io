
<h1>
<span id="rust-ã®-proptest-ã®ç´¹ä»‹" class="fragment"></span><a href="#rust-%E3%81%AE-proptest-%E3%81%AE%E7%B4%B9%E4%BB%8B"><i class="fa fa-link"></i></a>Rust ã® Proptest ã®ç´¹ä»‹</h1>

<p>ã“ã®è¨˜äº‹ã¯ <a href="https://qiita.com/advent-calendar/2018/property-based-testing">Property-Based Testing Advent Calendar 2018</a> ã® 13 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>

<p>ã“ã‚Œâ†’ <a href="https://github.com/AltSysrq/proptest/" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/AltSysrq/proptest/</a></p>

<p>å‹ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹ quickcheck ã¨é•ã£ã¦å…·ä½“çš„ãªå€¤ã®ç¯„å›²ã‚’è¨­å®šã§ãã‚‹ã®ãŒç‰¹å¾´ã§ã™ã€‚</p>

<h2>
<span id="0-ã‹ã‚‰-9-ã®å€¤ã®ç”Ÿæˆ" class="fragment"></span><a href="#0-%E3%81%8B%E3%82%89-9-%E3%81%AE%E5%80%A4%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>0 ã‹ã‚‰ 9 ã®å€¤ã®ç”Ÿæˆ</h2>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">#[macro_use]</span>
<span class="k">extern</span> <span class="n">crate</span> <span class="n">proptest</span><span class="p">;</span>

<span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">test_addition</span><span class="p">(</span><span class="n">a</span> <span class="n">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span> <span class="n">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"a:{}, b:{}"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="nd">prop_assert!</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">18</span><span class="p">);</span>
        <span class="c">// a:1, b:8</span>
        <span class="c">// a:9, b:0</span>
        <span class="c">// a:5, b:4</span>
        <span class="c">// a:5, b:1</span>
        <span class="c">// a:8, b:5</span>
        <span class="c">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="æ—¥ä»˜ã®ç”Ÿæˆ" class="fragment"></span><a href="#%E6%97%A5%E4%BB%98%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>æ—¥ä»˜ã®ç”Ÿæˆ</h2>

<p>ä¾‹ãˆã° è¥¿æš¦0å¹´ã‹ã‚‰ 3000 å¹´ã¾ã§ã®æ—¥ä»˜ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ 10 å€‹ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã“ã†æ›¸ãã¾ã™ã€‚<br>
å€¤ã®å‹ã‚‚åˆã‚ã›ã¦æ›¸ã‘ã¾ã™</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span> <span class="p">{</span>
    <span class="c">// #[test] ã®å‰ã«ãƒ†ã‚¹ãƒˆã®è¨­å®šãŒæ›¸ã‘ã¾ã™</span>
    <span class="nd">#![proptest_config(ProptestConfig</span> <span class="err">{</span>
        <span class="nd">cases:</span> <span class="mi">10</span><span class="nd">,</span>
        <span class="err">..</span> <span class="nd">ProptestConfig::default()</span>
    <span class="err">}</span><span class="nd">)]</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">parses_date_back_to_original</span><span class="p">(</span><span class="n">y</span> <span class="n">in</span> <span class="mi">0u32</span><span class="o">..</span><span class="mi">3000</span><span class="p">,</span> <span class="n">m</span> <span class="n">in</span> <span class="mi">1u32</span><span class="o">..</span><span class="mi">13</span><span class="p">,</span> <span class="n">d</span> <span class="n">in</span> <span class="mi">1u32</span><span class="o">..</span><span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}-{}/{}"</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
        <span class="c">// 2089-2/26</span>
        <span class="c">// 2743-9/7</span>
        <span class="c">// 1331-4/9</span>
        <span class="c">// 19-8/22</span>
        <span class="c">// 617-5/30</span>
        <span class="c">// 2562-9/2</span>
        <span class="c">// 2867-3/4</span>
        <span class="c">// 2629-10/5</span>
        <span class="c">// 32-1/30</span>
        <span class="c">// 2125-12/19</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="å‹ã«ã‚ˆã‚‹ç”Ÿæˆ" class="fragment"></span><a href="#%E5%9E%8B%E3%81%AB%E3%82%88%E3%82%8B%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>å‹ã«ã‚ˆã‚‹ç”Ÿæˆ</h2>

<p><code>std::u8::MIN</code> ã‹ã‚‰ <code>std::u8::MAX</code> ã¾ã§ã®å€¤ãŒç”Ÿæˆã•ã‚Œã¾ã™</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">addition_is_commutative</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">u8</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"a:{}, b:{}"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="nd">prop_assert_eq!</span><span class="p">(</span><span class="n">a</span> <span class="k">as</span> <span class="nb">u16</span> <span class="o">+</span> <span class="n">b</span> <span class="k">as</span> <span class="nb">u16</span><span class="p">,</span> <span class="n">b</span> <span class="k">as</span> <span class="nb">u16</span> <span class="o">+</span> <span class="n">a</span> <span class="k">as</span> <span class="nb">u16</span><span class="p">);</span>
        <span class="c">// a:144, b:204</span>
        <span class="c">// a:199, b:67</span>
        <span class="c">// a:61, b:137</span>
        <span class="c">// a:9, b:246</span>
        <span class="c">// a:217, b:63</span>
        <span class="c">// a:254, b:41</span>
        <span class="c">// a:102, b:49</span>
        <span class="c">// a:228, b:58</span>
        <span class="c">// a:120, b:77</span>
        <span class="c">// a:180, b:206</span>
        <span class="c">// a:80, b:238</span>
        <span class="c">// a:214, b:10</span>
        <span class="c">// a:27, b:60</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="æ–‡å­—åˆ—ã®ç”Ÿæˆ" class="fragment"></span><a href="#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>æ–‡å­—åˆ—ã®ç”Ÿæˆ</h2>

<p>String å‹ã‚’æŒ‡å®šã™ã‚‹ã¨ä»»æ„é•·ã®æ–‡å­—åˆ—ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">test_string_concat2</span><span class="p">(</span><span class="n">a</span> <span class="n">in</span> <span class="s">".*"</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"a:{}, b:{}"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">cat</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{}{}"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="nd">prop_assert_eq!</span><span class="p">(</span><span class="n">a</span><span class="nf">.len</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="nf">.len</span><span class="p">(),</span> <span class="n">cat</span><span class="nf">.len</span><span class="p">());</span>
        <span class="c">// a:</span>
        <span class="c">// '%C&lt;*3/ğ»°µ       Â¥?ï¿½ò¶¦³wNW:uXÑ¨à·†</span>
        <span class="c">// a:Â§&lt;, b:ã‡ƒ.$ğ›°.&lt;ğ•†ğ‘µ àª¶&amp;ğ£´Lá¾¾Â¥"</span>
        <span class="c">// a:=Ñ¨òŠ¤~)ï»¿ò¯”»ğ¨ Š`$ï»¿ğŸ°, b:5.2ï¿½~â·,ê¡„Ã«âƒ¡</span>
        <span class="c">// a:ó³¦¦&lt;?òŠ²‹*u%, b:Cà±‹\à¦‡ğ’‘ˆà³ŒğŸ•´</span>
        <span class="c">// a:ñµ§˜</span>
        <span class="c">//    ò¥°¡)*\ò¤´—bï»¿ó¢ª/ï¿½Ñ¨o&amp;izó¦‹&lt;0O)xğ¿‹„?$&amp;g, b:&gt;à«‡={ğ‘šà²¿ğ–¿¡ğ¼±</span>
        <span class="c">// a:'{w"ğµ±­ñ™¯%ó‰¸‡&lt;Ã¹Âª, b:"&lt;)á¶ğ«[à·.ğŠ²à¶½/á½\=%Tğ‘„¿OH</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>æ–‡å­—åˆ—ã®ç”Ÿæˆã«ã¯æ­£è¦è¡¨ç¾ã‚‚ä½¿ãˆã¾ã™ã€‚</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">test_string_concat</span><span class="p">(</span><span class="n">a</span> <span class="n">in</span> <span class="s">".*"</span><span class="p">,</span> <span class="n">b</span> <span class="n">in</span> <span class="s">".*"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"a:{}, b:{}"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">cat</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{}{}"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="nd">prop_assert_eq!</span><span class="p">(</span><span class="n">a</span><span class="nf">.len</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="nf">.len</span><span class="p">(),</span> <span class="n">cat</span><span class="nf">.len</span><span class="p">());</span>
        <span class="c">// a:Lò™¼³RHï¿½ñ·¡¯ñ¥òœ±‡.$ï¿½*$xó¡¡™ó„¸‘?, b:ğ‹ˆÑ¨.ï¸–</span>
        <span class="c">// N/, b:/0U&amp;\ğ¤¦/á¸{\Â°é²™/ğŸ§€aê¬Œ{á½Œ0á°¡%.5</span>
        <span class="c">// a:ñ ¼¯$$ï¿½ò¨›“%Ñ¨T8^KlÂ¥ï›½So&lt;</span>
        <span class="c">//                 , b:l#.á¿³ğŠ‰à¶ƒğ—«¸{á½ˆ'</span>
        <span class="c">// a:ñ—œ¸Ã«"Ã±ğ´¨=t=*&amp;ò—¨­|{YWÂ¥$`{&lt;'{ğ‘‚¸.ô€§¬{"Ñ¨ z, b:C'@?5ğ„³=Ú¼3?\oâ¿²â´‘Â¥ğ¨ºğŸ¦²</span>
        <span class="c">// ô‚˜°., b:$á³†xà®£â¶¥,áª³Itï·â€„ğ‘‹·ï¿ğ£µê£xcm?Wà·–Uğ¨¥$â¶­*</span>
        <span class="c">// a:+%&lt;\&lt;ò§ò¬½¶\'!:óŸªMğŸ•´{ğŸ•´iğŸ•´&amp;y.ó¬…Ÿ, b:&lt;ğŸ•´rjcğ¹‹mRà·Ÿq{Öê¬ƒ'ğ‘Œªq{{=Â²$</span>
        <span class="c">// a:ğ¹‚Ÿğ½Š{ó³«’?p,*$?r&lt;", b:</span>
        <span class="c">// OÑ¨&amp;ñ¤Š¤'ñ»²–}ñ´³‹.'ï»¿."    E.ñŸ%LE%=kÂ³$\ï¿½ò¢¹œb/ò…ƒó˜¾\, b:ğ’mÚ–{Â¥`uàº¥</span>
        <span class="c">// a:ò„ˆ´"Ñ¨$*'%, b:"ïµœğ‘Œ³\</span>
        <span class="c">// a:B=/&amp;ğŸ•´ò€£·ï¿½ó†‰Â¥":Y  kL, b:$Â¥\?caP'Â¥0/&amp;"rï¸™á½›</span>
        <span class="c">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>æ—¥ä»˜ã£ã½ã„æ–‡å­—åˆ—</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">parses_all_valid_dates</span><span class="p">(</span><span class="n">s</span> <span class="n">in</span> <span class="s">"[0-9]{4}-[0-9]{2}-[0-9]{2}"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}-{}/{}"</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
        <span class="c">// 1667-77-67</span>
        <span class="c">// 5076-51-20</span>
        <span class="c">// 4487-07-47</span>
        <span class="c">// 3281-25-92</span>
        <span class="c">// 2818-71-60</span>
        <span class="c">// 5361-52-97</span>
        <span class="c">// 0196-34-59</span>
        <span class="c">// 9202-17-16</span>
        <span class="c">// 8864-17-26</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>ä»»æ„ã®éåˆ¶å¾¡æ–‡å­—ã§æ§‹æˆã•ã‚ŒãŸä»»æ„ã®æ–‡å­—åˆ—</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">doesnt_crash</span><span class="p">(</span><span class="n">s</span> <span class="n">in</span> <span class="s">"</span><span class="se">\\</span><span class="s">PC*"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
        <span class="c">// %'Ãºà°¯$ï¸¨á½›n'{ğ‘˜´&lt;á¬/:ğ¤¿({ğŸ•´ğ¡‡{=ZÑ¨ğ‘’¸à®¾ğ¸»Ë±à¼£:I</span>
        <span class="c">// F`ï¬—wÂ½:`ğ‘†”6</span>
        <span class="c">// u</span>
        <span class="c">// ğŸ‰¢à¿ˆ6'ğŸ¦´ğ¨—ğ ¸à²¸|</span>
        <span class="c">// là­ˆï¹©?/7ğ–­Ÿqt</span>
        <span class="c">// ?}&amp;`Iï¿½`à®šíŸ€'f;áŸ’</span>
        <span class="c">// yE$/Â¥=`ï¿½×¯à±†=ğ‘´¡=ğ«®“7</span>
        <span class="c">// àº¥"{à³–ê§³à³²x{%%7h×š</span>
        <span class="c">// 9v^/â·ƒ`</span>
        <span class="c">// L6</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</h2>

<p>ãƒ†ã‚¹ãƒˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã§ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br>
ã“ã‚Œã«ã‚ˆã‚Šãƒ†ã‚¹ãƒˆã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã§ãã¾ã™ã€‚<br>
ã“ã®ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°é–¢æ•°ã¯ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã€ã¾ãŸã¯ u64 ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã£ã¦ãƒ‘ãƒ‹ãƒƒã‚¯ã—ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã™ã€‚</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="k">fn</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u64</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="n">n</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">proptest!</span> <span class="p">{</span>
    <span class="nd">#![proptest_config(ProptestConfig</span> <span class="err">{</span>
        <span class="nd">fork:</span> <span class="kc">true</span><span class="nd">,</span>
        <span class="nd">timeout:</span> <span class="mi">1000</span><span class="nd">,</span>
        <span class="err">..</span> <span class="nd">ProptestConfig::default()</span>
    <span class="err">}</span><span class="nd">)]</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">test_fib</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯ç’°å¢ƒå¤‰æ•°ã§ã‚‚æ¸¡ã›ã¾ã™</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre><span class="go">PROPTEST_FORK=true cargo test
PROPTEST_TIMEOUT=1000 cargo test
</span></pre></div></div>

<p><code>PROPTEST_TIMEOUT</code> ã‚’è¨­å®šã—ãŸã‚‰è‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ã‚¯ã•ã‚Œã‚‹ã®ã§è¨­å®šã™ã‚‹ã®ã¯ <code>fork</code> ã‹ <code>timeout</code> ã®ã©ã¡ã‚‰ã‹ã§è‰¯ã„ã§ã™ã€‚</p>

<h2>
<span id="ã²ã¨ã¤ã®ãƒ†ã‚¹ãƒˆã®ä¸­ã§è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä½œã‚‹" class="fragment"></span><a href="#%E3%81%B2%E3%81%A8%E3%81%A4%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E4%B8%AD%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%82%B1%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>ã²ã¨ã¤ã®ãƒ†ã‚¹ãƒˆã®ä¸­ã§è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä½œã‚‹</h2>

<p>ã²ã¨ã¤ã®ãƒ†ã‚¹ãƒˆã®ä¸­ã§è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚<br>
ãƒ†ã‚¹ãƒˆã®ãŸã³ã«é‡ã„åˆæœŸåŒ–å‡¦ç†ã‚’ã—ãªãã¦ã‚‚ã‚ˆããªã‚‹ãŸã‚ä¾¿åˆ©ã§ã™ã€‚<br>
ãŸã ã—ã“ã®æ–¹æ³•ã§ä½œã‚‰ã‚ŒãŸãƒ†ã‚¹ãƒˆã§ã¯ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">my_test</span><span class="p">()</span> <span class="p">{</span>
    <span class="c">// ç’°å¢ƒå¤‰æ•°ã‚’èª­ã‚“ã ã‚Š</span>
    <span class="nn">dotenv</span><span class="p">::</span><span class="nf">dotenv</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="nn">env_logger</span><span class="p">::</span><span class="nf">try_init</span><span class="p">()</span><span class="nf">.ok</span><span class="p">();</span>
    <span class="nd">#[derive(Clone,</span> <span class="nd">Debug,</span> <span class="nd">Deserialize)]</span>
    <span class="k">struct</span> <span class="n">Config</span> <span class="p">{</span>
        <span class="n">database_url</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="n">config</span> <span class="o">=</span> <span class="nn">envy</span><span class="p">::</span><span class="nn">from_env</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="c">// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ãŸã‚Šã§ãã¾ã™</span>
    <span class="k">let</span> <span class="n">db</span> <span class="o">=</span> <span class="nn">Db</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="py">.database_url</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="c">// ãƒã‚¯ãƒ­ã®éƒ½åˆã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®å¼•æ•°ã¯ã‚¿ãƒ—ãƒ«ã§æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™</span>
    <span class="nd">proptest!</span><span class="p">(|(</span><span class="n">x</span> <span class="n">in</span> <span class="mi">0u32</span><span class="o">..</span><span class="mi">42u32</span><span class="p">,</span> <span class="n">y</span> <span class="n">in</span> <span class="mi">1000u32</span><span class="o">..</span><span class="mi">100000u32</span><span class="p">)|</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"x:{}, y:{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c">// move ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚‚ä½¿ãˆã¾ã™</span>
    <span class="nd">proptest!</span><span class="p">(</span><span class="k">move</span> <span class="p">|(</span><span class="n">x</span> <span class="n">in</span> <span class="mi">0u32</span><span class="o">..</span><span class="mi">42u32</span><span class="p">)|</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"x:{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c">// ãƒã‚¯ãƒ­ã®ç¬¬ä¸€å¼•æ•°ã«ãƒ†ã‚¹ãƒˆã®è¨­å®šã‚’æ¸¡ã›ã¾ã™</span>
    <span class="nd">proptest!</span><span class="p">(</span><span class="nn">ProptestConfig</span><span class="p">::</span><span class="nf">with_cases</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">|(</span><span class="n">x</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)|</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"x:{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä¿å­˜" class="fragment"></span><a href="#%E5%A4%B1%E6%95%97%E3%81%97%E3%81%9F%E3%83%86%E3%82%B9%E3%83%88%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%AE%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä¿å­˜</h2>

<p><code>proptest-regressions</code> ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒä¿å­˜ã•ã‚Œã¾ã™</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">tests/test.proptest-regressions</span></div>
<div class="highlight"><pre># Seeds for failure cases proptest has generated in the past. It is
# automatically read and these particular cases re-run before any
# novel cases are generated.
#
# It is recommended to check this file in to source control so that
# everyone who runs the test benefits from these saved cases.
xs 1701150751 4032634173 2240973666 2150442205 # shrinks to all_data = -1, offset = 0, limit = 0
xs 284604027 460482942 1202867123 218470716 # shrinks to all_data = 0, offset = 9223372036854775809, limit = 1
</pre></div>
</div>

<h2>
<span id="strategy-ã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ç”Ÿæˆ" class="fragment"></span><a href="#strategy-%E3%81%AB%E3%82%88%E3%82%8B%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%86%E3%82%B9%E3%83%88%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>Strategy ã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ç”Ÿæˆ</h2>

<p><a href="https://altsysrq.github.io/rustdoc/proptest/latest/proptest/index.html#strategy-basics" class="autolink" rel="nofollow noopener" target="_blank">https://altsysrq.github.io/rustdoc/proptest/latest/proptest/index.html#strategy-basics</a></p>

<p><code>proptest!</code> ãƒã‚¯ãƒ­ã®ä¸­ã§ã¯æ¬¡ã®ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="k">extern</span> <span class="n">crate</span> <span class="n">proptest</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">proptest</span><span class="p">::</span><span class="nn">test_runner</span><span class="p">::</span><span class="n">TestRunner</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">proptest</span><span class="p">::</span><span class="nn">strategy</span><span class="p">::{</span><span class="n">Strategy</span><span class="p">,</span> <span class="n">ValueTree</span><span class="p">};</span>

<span class="k">fn</span> <span class="nf">some_function</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// Do a bunch of stuff, but crash if v &gt; 500</span>
    <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">some_function_doesnt_crash</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">runner</span> <span class="o">=</span> <span class="nn">TestRunner</span><span class="p">::</span><span class="nf">default</span><span class="p">();</span>
    <span class="k">for</span> <span class="mi">_</span> <span class="n">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">256</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">10000i32</span><span class="p">)</span><span class="nf">.new_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">runner</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nf">some_function</span><span class="p">(</span><span class="n">val</span><span class="nf">.current</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="shrinking-ã«ã‚ˆã‚‹æœ€å°é™ã®å¤±æ•—ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ¢ç´¢" class="fragment"></span><a href="#shrinking-%E3%81%AB%E3%82%88%E3%82%8B%E6%9C%80%E5%B0%8F%E9%99%90%E3%81%AE%E5%A4%B1%E6%95%97%E3%83%86%E3%82%B9%E3%83%88%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%AE%E6%8E%A2%E7%B4%A2"><i class="fa fa-link"></i></a>Shrinking ã«ã‚ˆã‚‹æœ€å°é™ã®å¤±æ•—ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ¢ç´¢</h2>

<p><a href="https://altsysrq.github.io/rustdoc/proptest/latest/proptest/#shrinking-basics" class="autolink" rel="nofollow noopener" target="_blank">https://altsysrq.github.io/rustdoc/proptest/latest/proptest/#shrinking-basics</a></p>

<p>æ¬¡ã®ä¾‹ã¯å¤±æ•—ã™ã‚‹ã¨ã‚ã‹ã£ã¦ã„ã‚‹é–¢æ•°ã«é–¢ã—ã¦ã‚ˆã‚Šå˜ç´”ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ¢ç´¢ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚<br>
<code>simplify</code> ã«ã‚ˆã£ã¦ç”Ÿæˆã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ã‚ˆã‚Šå˜ç´”ãªã‚‚ã®ã¸ã¨ç¸®å°ã—ã¦ã„ãã€<br>
<code>complicate</code> ã§ã‚ˆã‚Šè¤‡é›‘ãªã‚‚ã®ã¸ã¨æ‹¡å¤§ã—ã¦ã„ãã“ã¨ã§ã€<br>
æœ€ä½é™ã®å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ¢ç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="k">extern</span> <span class="n">crate</span> <span class="n">proptest</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">proptest</span><span class="p">::</span><span class="nn">test_runner</span><span class="p">::</span><span class="n">TestRunner</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">proptest</span><span class="p">::</span><span class="nn">strategy</span><span class="p">::{</span><span class="n">Strategy</span><span class="p">,</span> <span class="n">ValueTree</span><span class="p">};</span>

<span class="c">// ã“ã® some_function ã¯ 501 ä»¥ä¸Šã®å€¤ã‚’å…¥åŠ›ã™ã‚‹ã¨å¤±æ•—ã™ã‚‹é–¢æ•°ã ã¨ã—ã¾ã™ã€‚</span>
<span class="c">// ã‚ã‚‹å¤±æ•—ã™ã‚‹ã¨ã‚ã‹ã£ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆã«é–¢ã—ã¦ã€</span>
<span class="c">// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æˆåŠŸã¨å¤±æ•—ã‚’ bool ã§è¡¨ã™ã“ã¨ã«ã‚ˆã‚Šã€</span>
<span class="c">// ã‚ˆã‚Šå˜ç´”ãªã‚±ãƒ¼ã‚¹ã‚’æ¢ç´¢ã—ã¾ã™</span>
<span class="k">fn</span> <span class="nf">some_function</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">500</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">runner</span> <span class="o">=</span> <span class="nn">TestRunner</span><span class="p">::</span><span class="nf">default</span><span class="p">();</span>

    <span class="c">// 256 å›æ¢ç´¢ã‚’è©¦ã¿ã‚‹</span>
    <span class="k">for</span> <span class="mi">_</span> <span class="n">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">256</span> <span class="p">{</span>
        <span class="c">// 10000i32 ã‹ã‚‰å€¤ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚ã“ã®å ´åˆã¯ 10000 ã‹ã‚‰ 0 ã¸ã¨çµã‚Šè¾¼ã‚“ã§ã„ãã¾ã™</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">10000i32</span><span class="p">)</span><span class="nf">.new_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">runner</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">if</span> <span class="nf">some_function</span><span class="p">(</span><span class="n">val</span><span class="nf">.current</span><span class="p">())</span> <span class="p">{</span>
            <span class="c">// ã“ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¯æˆåŠŸã—ãŸã®ã§ä»–ã«å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ¢ã™</span>
            <span class="n">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c">// some_function ãŒ false ã‚’è¿”ã—ãŸã®ã§ã‚ˆå˜ç´”ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ¢ç´¢ã™ã‚‹</span>
        <span class="k">loop</span> <span class="p">{</span>
            <span class="k">if</span> <span class="o">!</span><span class="nf">some_function</span><span class="p">(</span><span class="n">val</span><span class="nf">.current</span><span class="p">())</span> <span class="p">{</span>
                <span class="c">// ãƒ†ã‚¹ãƒˆãŒè½ã¡ãŸã®ã§ã‚ˆã‚Šå˜ç´”ãªã‚±ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‘ãŸ</span>
                <span class="k">if</span> <span class="o">!</span><span class="n">val</span><span class="nf">.simplify</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c">// ã“ã‚Œä»¥ä¸Šå˜ç´”åŒ–ã§ããªã„</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c">// ã“ã®å˜ç´”åŒ–ã—ãŸãƒ†ã‚¹ãƒˆã¯æˆåŠŸã—ã¦ã—ã¾ã£ãŸã®ã§ã‚‚ã†å°‘ã—è¤‡é›‘ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™</span>
                <span class="k">if</span> <span class="o">!</span><span class="n">val</span><span class="nf">.complicate</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nd">println!</span><span class="p">(</span><span class="s">"The minimal failing case is {}"</span><span class="p">,</span> <span class="n">val</span><span class="nf">.current</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">501</span><span class="p">,</span> <span class="n">val</span><span class="nf">.current</span><span class="p">());</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nd">panic!</span><span class="p">(</span><span class="s">"Didn't find a failing test case"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="ãƒ‘ãƒ‹ãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©" class="fragment"></span><a href="#%E3%83%91%E3%83%8B%E3%83%83%E3%82%AF%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9"><i class="fa fa-link"></i></a>ãƒ‘ãƒ‹ãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©</h2>

<p><a href="https://altsysrq.github.io/rustdoc/proptest/latest/proptest/#using-the-test-runner" class="autolink" rel="nofollow noopener" target="_blank">https://altsysrq.github.io/rustdoc/proptest/latest/proptest/#using-the-test-runner</a></p>

<p>proptest ã® TestRunner ã¯ <code>Result&lt;_, TestError&gt;</code> ã¾ãŸã¯ãƒ‘ãƒ‹ãƒƒã‚¯ã‚’å¤±æ•—ã¨ã—ã¦å–ã‚Šæ‰±ã†ã“ã¨ãŒã§ãã¾ã™</p>

<h2>
<span id="ã‚«ã‚¹ã‚¿ãƒ æˆ¦ç•¥ã‚’ä½œã‚‹" class="fragment"></span><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E6%88%A6%E7%95%A5%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>ã‚«ã‚¹ã‚¿ãƒ æˆ¦ç•¥ã‚’ä½œã‚‹</h2>

<p>ä»»æ„ã® i8 ç›¸å½“ã® String ã‚’ç”Ÿæˆ</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">proptest!</span><span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">test</span><span class="p">(</span><span class="n">o</span> <span class="n">in</span> <span class="nn">any</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">i8</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.prop_map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span><span class="nf">.to_string</span><span class="p">())){</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
        <span class="c">// "-65"</span>
        <span class="c">// "-119"</span>
        <span class="c">// "43"</span>
        <span class="c">// "-56"</span>
        <span class="c">// "65"</span>
        <span class="c">// "-48"</span>
        <span class="c">// "22"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>æ§‹é€ ä½“</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="nd">#[derive(Clone,</span> <span class="nd">Debug)]</span>
<span class="k">struct</span> <span class="n">Order</span> <span class="p">{</span>
  <span class="n">id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="n">item</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="n">quantity</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">gen_order</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Strategy</span><span class="o">&lt;</span><span class="n">Value</span> <span class="o">=</span> <span class="n">Order</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="p">(</span><span class="nn">any</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">u32</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.prop_map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span><span class="nf">.to_string</span><span class="p">()),</span>
        <span class="s">"[a-z]*"</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1000u32</span><span class="p">)</span><span class="nf">.prop_map</span><span class="p">(</span>
            <span class="p">|(</span><span class="n">id</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)|</span> <span class="n">Order</span> <span class="p">{</span> <span class="n">id</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">quantity</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nd">proptest!</span><span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">test_order</span><span class="p">(</span><span class="n">o</span> <span class="n">in</span> <span class="nf">gen_order</span><span class="p">()){</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
        <span class="c">// Order { id: "3372296639", item: "yybosjbnvryotdoeglcmpxia", quantity: 383 }</span>
        <span class="c">// Order { id: "2833625993", item: "deshvxgsqywccnllzjasffgfpqlbzlo", quantity: 486 }</span>
        <span class="c">// Order { id: "3260047346", item: "hhhsylstdlxotrjrvj", quantity: 256 }</span>
        <span class="c">// Order { id: "3833458271", item: "pbmrvxbguybyvwjzod", quantity: 305 }</span>
        <span class="c">// Order { id: "3864500675", item: "idmugc", quantity: 454 }</span>
        <span class="c">// Order { id: "2807396473", item: "jjnbygsbrjkkgzyrdtadhslmxllie", quantity: 701 }</span>
        <span class="c">// Order { id: "3619398342", item: "flcqcwuimcqgiajtmzev", quantity: 760 }</span>
        <span class="c">// Order { id: "2618995400", item: "wpbcsnhwpauvysjlxtbakiimj", quantity: 375 }</span>
        <span class="c">// Order { id: "3882359522", item: "tzfwrudqwko", quantity: 486 }</span>
        <span class="c">// Order { id: "407582390", item: "mnxpkntwukoh", quantity: 221 }</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p><code>Option&lt;i8&gt;</code> ã®ã‚ˆã†ãªåˆ—æŒ™å‹ã¯ <code>prop_oneof!</code> ãƒã‚¯ãƒ­ã‚’ä½¿ã†ã€‚<br>
ãƒªã‚¹ãƒˆã®ä¸€ç•ªå¾Œã‚ã‚’ä¸€ç•ªè¤‡é›‘ãªã‚±ãƒ¼ã‚¹ã«ã—ã¦ã€æ‰‹å‰ã»ã©ç°¡å˜ãªã‚±ãƒ¼ã‚¹ã«ã™ã‚‹ã¨ã†ã¾ã shrinking ã‚’ã‚„ã£ã¦ãã‚Œã‚‹ - <a href="https://altsysrq.github.io/rustdoc/proptest/latest/proptest/#generating-enums" class="autolink" rel="nofollow noopener" target="_blank">https://altsysrq.github.io/rustdoc/proptest/latest/proptest/#generating-enums</a></p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre>
<span class="k">fn</span> <span class="nf">gen_opt</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Strategy</span><span class="o">&lt;</span><span class="n">Value</span> <span class="o">=</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">i8</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="nd">prop_oneof!</span><span class="p">[</span>
        <span class="nf">Just</span><span class="p">(</span><span class="nb">None</span><span class="p">),</span>
        <span class="nn">any</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">i8</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.prop_map</span><span class="p">(|</span><span class="n">i</span><span class="p">|</span> <span class="nf">Some</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="nd">proptest!</span><span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">opt_test</span><span class="p">(</span><span class="n">o</span> <span class="n">in</span> <span class="nf">gen_opt</span><span class="p">()){</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
        <span class="c">// None</span>
        <span class="c">// Some(24)</span>
        <span class="c">// None</span>
        <span class="c">// Some(-89)</span>
        <span class="c">// None</span>
        <span class="c">// None</span>
        <span class="c">// None</span>
        <span class="c">// Some(-54)</span>
        <span class="c">// None</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="é«˜éšã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼" class="fragment"></span><a href="#%E9%AB%98%E9%9A%8E%E3%82%B9%E3%83%88%E3%83%A9%E3%83%86%E3%82%B8%E3%83%BC"><i class="fa fa-link"></i></a>é«˜éšã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼</h2>

<p>ä»»æ„é•·ã®ã® Vec ã¨ã€ãã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã® usize ãŒæ¬²ã—ã„å ´åˆã€ã¾ãšä»»æ„é•·ã®ãŒ Vec ã‚’ä½œã£ã¦ã‹ã‚‰ã€ ãã® len ã®ç¯„å›²å†…ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã¨ä¾¿åˆ©ã§ã™</p>

<div class="code-frame" data-lang="rust"><div class="highlight"><pre><span class="k">fn</span> <span class="nf">vec_and_index</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Strategy</span><span class="o">&lt;</span><span class="n">Value</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nn">prop</span><span class="p">::</span><span class="nn">collection</span><span class="p">::</span><span class="nf">vec</span><span class="p">(</span><span class="nn">any</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;</span><span class="p">(),</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span>
        <span class="nf">.prop_flat_map</span><span class="p">(|</span><span class="n">vec</span><span class="p">|</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="n">vec</span><span class="nf">.len</span><span class="p">();</span>
            <span class="p">(</span><span class="nf">Just</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="mi">0</span><span class="o">..</span><span class="n">len</span><span class="p">)</span>
        <span class="p">})</span>
<span class="p">}</span>

<span class="nd">proptest!</span><span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">vec_test</span><span class="p">(</span><span class="n">o</span> <span class="n">in</span> <span class="nf">gen_opt</span><span class="p">()){</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
        <span class="c">// ([155, 132, 216, 101, 111, 103, 141, 154], 6)</span>
        <span class="c">// ([24, 240], 1)</span>
        <span class="c">// ([105, 54, 102, 54, 187, 32, 252], 6)</span>
        <span class="c">// ([252, 88, 150, 52, 105, 102, 7, 152], 0)</span>
        <span class="c">// ([218, 143, 62, 85, 194, 73, 57], 5)</span>
        <span class="c">// ([45, 145, 182, 93, 225, 140], 1)</span>
        <span class="c">// ([254], 0)</span>
        <span class="c">// ([123, 80, 121, 19, 228, 48, 134], 4)</span>
        <span class="c">// ([181, 37], 1)</span>
        <span class="c">// ([214, 251, 140, 179, 227, 126], 0)</span>
        <span class="c">// ([154, 203, 139, 20, 83, 15], 0)</span>
        <span class="c">// ([14], 0)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="ãã®ä»–ã®æ©Ÿèƒ½" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>ãã®ä»–ã®æ©Ÿèƒ½</h2>

<p>ã“ã“ãŒè©³ã—ã„ã§ã™ <del><a href="https://altsysrq.github.io/rustdoc/proptest/latest/proptest/" class="autolink" rel="nofollow noopener" target="_blank">https://altsysrq.github.io/rustdoc/proptest/latest/proptest/</a></del> â†’ <a href="https://altsysrq.github.io/proptest-book/intro.html" class="autolink" rel="nofollow noopener" target="_blank">https://altsysrq.github.io/proptest-book/intro.html</a></p>
